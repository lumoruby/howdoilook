<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë‚˜ì™€ ë‹®ì€ ë™ë¬¼ ì°¾ê¸°</title>
  <link href='/style.css' rel='stylesheet'>
  <script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
</head>
<body>
  <nav class="nav">
    <a href="index.html" class="nav-logo">ë‚˜ì™€ ë‹®ì€ ë™ë¬¼ ì°¾ê¸°</a>
    <div class="nav-links">
      <a href="index.html">í™ˆ</a>
      <a href="about.html">ì†Œê°œ</a>
      <a href="form.html">ë¬¸ì˜</a>
    </div>
  </nav>

  <div class="container">
    <h1>ğŸ¾ ë‚˜ì™€ ë‹®ì€ ë™ë¬¼ì€?</h1>
    <p class="subtitle">ì¹´ë©”ë¼ë¡œ ì–¼êµ´ì„ ë¹„ì¶”ë©´ ë‹®ì€ ë™ë¬¼ì„ ì°¾ì•„ë“œë ¤ìš”!</p>

    <div class="camera-container">
      <video id="video" autoplay muted playsinline></video>
      <canvas id="overlay"></canvas>
      <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>ëª¨ë¸ ë¡œë”© ì¤‘...</p>
      </div>
    </div>

    <button id="captureBtn" class="capture-btn" disabled>
      ğŸ“¸ ì‚¬ì§„ ì°ê¸°
    </button>

    <div id="result" class="result hidden">
      <div class="result-card">
        <div id="animalEmoji" class="animal-emoji"></div>
        <h2 id="animalName"></h2>
        <p id="animalDesc"></p>
        <div class="match-bar">
          <div id="matchPercent" class="match-fill"></div>
        </div>
        <p id="matchText" class="match-text"></p>
      </div>
      <button id="retryBtn" class="retry-btn">ë‹¤ì‹œ ì°ê¸°</button>
    </div>
    
    <div class="comments-section">
      <h3>ğŸ’¬ ëŒ“ê¸€</h3>
      <div class="comment-form">
        <input type="text" id="commentName" placeholder="ë‹‰ë„¤ì„" maxlength="20">
        <textarea id="commentText" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." maxlength="500"></textarea>
        <button id="commentSubmit" class="comment-btn">ëŒ“ê¸€ ì‘ì„±</button>
      </div>
      <div id="commentList" class="comment-list"></div>
    </div>
  </div>

  <script defer type="text/javascript" src="/main.js"></script>
  <script>
    (function() {
      const STORAGE_KEY = 'howdoilook_comments_index';

      function loadComments() {
        return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
      }

      function saveComments(comments) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(comments));
      }

      function formatDate(timestamp) {
        const date = new Date(timestamp);
        return date.toLocaleDateString('ko-KR') + ' ' + date.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'});
      }

      function renderComments() {
        const comments = loadComments();
        const list = document.getElementById('commentList');

        if (comments.length === 0) {
          list.innerHTML = '<p class="no-comments">ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</p>';
          return;
        }

        list.innerHTML = comments.map(c => `
          <div class="comment-item">
            <div class="comment-header">
              <span class="comment-name">${escapeHtml(c.name)}</span>
              <span class="comment-date">${formatDate(c.timestamp)}</span>
            </div>
            <p class="comment-text">${escapeHtml(c.text)}</p>
          </div>
        `).join('');
      }

      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      document.getElementById('commentSubmit').addEventListener('click', function() {
        const name = document.getElementById('commentName').value.trim();
        const text = document.getElementById('commentText').value.trim();

        if (!name || !text) {
          alert('ë‹‰ë„¤ì„ê³¼ ëŒ“ê¸€ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }

        const comments = loadComments();
        comments.unshift({ name, text, timestamp: Date.now() });
        saveComments(comments);

        document.getElementById('commentName').value = '';
        document.getElementById('commentText').value = '';
        renderComments();
      });

      renderComments();
    })();
  </script>

  <footer class="footer">
    <div class="footer-content">
      <p>&copy; 2025 ë‚˜ì™€ ë‹®ì€ ë™ë¬¼ ì°¾ê¸°. All rights reserved.</p>
      <div class="footer-links">
        <a href="privacy.html">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
        <a href="terms.html">ì´ìš©ì•½ê´€</a>
        <a href="about.html">ì‚¬ì´íŠ¸ ì†Œê°œ</a>
        <a href="form.html">ë¬¸ì˜í•˜ê¸°</a>
      </div>
    </div>
  </footer>
</body>
</html>
